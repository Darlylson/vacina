<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#4CAF50">
  <title>Carteira de Vacinação</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
      margin: 0;
      background-color: #f2f2f2;
    }
    header {
      text-align: center;
      margin-bottom: 1rem;
    }
    h1 {
      color: #2e7d32;
    }
    .card {
      background-color: #fff;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }
    label {
      display: block;
      margin-top: 0.5rem;
    }
    input, button, select {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.25rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 0.5rem;
      border: 1px solid #ccc;
      text-align: left;
    }
    .btn-remove {
      color: red;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>Carteira de Vacinação</h1>
  </header>

  <div class="card">
    <h2>Selecionar Paciente</h2>
    <label>Paciente:
      <select id="paciente-select" onchange="preencherPaciente()">
        <option value="">-- Selecione --</option>
        <option value="Darlylson do Socorro Brito dos Santos">Darlylson do Socorro Brito dos Santos</option>
        <option value="Daniel Souza dos Santos">Daniel Souza dos Santos</option>
      </select>
    </label>
    <label>Nome:<input type="text" id="nome" readonly></label>
    <label>Data de Nascimento:<input type="date" id="nascimento" readonly></label>
  </div>

  <div class="card">
    <h2>Registrar Vacina</h2>
    <label>Vacina:<input type="text" id="vacina"></label>
    <label>Data de Aplicação:<input type="date" id="data"></label>
    <label>Lote:<input type="text" id="lote"></label>
    <label>Profissional:<input type="text" id="profissional"></label>
    <button onclick="adicionarVacina()">Adicionar</button>
  </div>

  <div class="card">
    <h2>Vacinas Aplicadas (Remoto)</h2>
    <table id="tabela">
      <thead>
        <tr>
          <th>Paciente</th>
          <th>Vacina</th>
          <th>Data</th>
          <th>Lote</th>
          <th>Profissional</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const tabela = document.querySelector("#tabela tbody");
    const pacientes = {
      "Darlylson do Socorro Brito dos Santos": "1972-12-07",
      "Daniel Souza dos Santos": "2014-02-28"
    };

    function preencherPaciente() {
      const select = document.getElementById("paciente-select");
      const nome = select.value;
      document.getElementById("nome").value = nome;
      document.getElementById("nascimento").value = pacientes[nome] || "";
    }

    async function carregarRemoto() {
      try {
        const res = await fetch("https://darlylson.github.io/vacina/registros.json");
        const dados = await res.json();
        tabela.innerHTML = "";
        dados.forEach(item => {
          const row = `<tr>
            <td>${item.nome}</td>
            <td>${item.vacina}</td>
            <td>${item.data}</td>
            <td>${item.lote}</td>
            <td>${item.profissional}</td>
          </tr>`;
          tabela.innerHTML += row;
        });
      } catch (e) {
        tabela.innerHTML = '<tr><td colspan="5">Erro ao carregar dados remotos.</td></tr>';
      }
    }

    async function adicionarVacina() {
      const nome = document.getElementById("nome").value;
      const nascimento = document.getElementById("nascimento").value;
      const vacina = document.getElementById("vacina").value;
      const data = document.getElementById("data").value;
      const lote = document.getElementById("lote").value;
      const profissional = document.getElementById("profissional").value;

      if (nome && vacina && data && lote && profissional) {
        const novo = { nome, nascimento, vacina, data, lote, profissional };

        try {
          const res = await fetch("https://SEU_BACKEND/salvar.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(novo)
          });
          if (res.ok) {
            alert("Registro salvo com sucesso.");
            carregarRemoto();
          } else {
            alert("Erro ao salvar os dados.");
          }
        } catch (e) {
          alert("Erro ao conectar com o servidor.");
        }
      } else {
        alert("Preencha todos os campos.");
      }
    }

    window.onload = carregarRemoto;
  </script>
</body>
</html>
